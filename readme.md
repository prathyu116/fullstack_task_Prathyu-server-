# Full Stack To-Do List - Backend

This is the backend service for the Full Stack To-Do List application. It's built with Node.js, Express, TypeScript, and uses MongoDB for persistent storage and Redis for caching. It also integrates with an MQTT broker for adding new tasks.

## Features

*   **Add Tasks:** New to-do items can be added by sending a message to an MQTT topic (`/add`).
*   **Redis Caching:** Tasks are initially stored in a Redis cache as a stringified array.
*   **MongoDB Storage:** If the number of items in the cache exceeds 50, items are moved to a MongoDB collection and flushed from the cache.
*   **Retrieve Tasks:** An HTTP API endpoint (`/api/tasks/fetchAllTasks`) allows fetching all tasks from both the cache and MongoDB.

## Tech Stack

*   **Node.js:** JavaScript runtime environment.
*   **Express.js:** Web framework for Node.js.
*   **TypeScript:** Superset of JavaScript that adds static typing.
*   **MongoDB (Mongoose):** NoSQL database for persistent storage of tasks.
*   **Redis (ioredis):** In-memory data store used for caching tasks.
*   **MQTT.js:** Client library for the MQTT protocol.
*   **dotenv:** For managing environment variables.



## Project Setup

1.  **Clone the repository :**
    ```bash
    git clone <your-repo-url>
    cd <your-repo-name>/backend
    ```

2.  **Install dependencies:**
    ```bash
    npm install
   
    ```

3.  **Set up Environment Variables:**
    Create a `.env` file in the `backend` root directory. Copy the contents of `.env.example` (if you create one) or use the template below and fill in your actual credentials and settings:

    ```env
    NODE_ENV=development
    PORT=3001

    # MongoDB Configuration
    MONGO_URI=mongodb+srv://<username>:<password>@<cluster-url>/<database_name>
    MONGO_DB_NAME=assignment

    # Redis Configuration
    REDIS_HOST=your-redis-host
    REDIS_PORT=your-redis-port
    REDIS_USERNAME=default 
    REDIS_PASSWORD=your-redis-password

    # MQTT Configuration
    MQTT_BROKER_URL=mqtt://test.mosquitto.org # Or your MQTT broker URL

    ```
    *   Update MongoDB, Redis, and MQTT connection details accordingly.

## Available Scripts

*   **`npm run build`**
    Compiles TypeScript to JavaScript (output to `dist` directory).

*   **`npm start`**
    Runs the compiled JavaScript application from the `dist` directory (for production).

*   **`npm run dev`**
    Runs the application in development mode using `ts-node` and `nodemon` for automatic restarts on file changes.

## API Endpoints

*   **`POST /api/tasks`**
    *   Adds a new task. The task content is sent in the request body.
    *   This endpoint publishes a message to the MQTT broker, which then handles storage.
    *   **Body:** `{ "content": "New task description" }`
    *   **Response:** `202 Accepted` with the new task object (optimistic).

*   **`GET /api/tasks/fetchAllTasks`**
    *   Retrieves all tasks from both Redis cache and MongoDB.
    *   **Response:** `200 OK` with an array of task objects.
        ```json
        [
          { "id": "uuid-string", "content": "Task 1", "createdAt": "iso-date-string" },
          { "id": "uuid-string", "content": "Task 2", "createdAt": "iso-date-string" }
        ]
        ```



## MQTT Integration

*   **Topic for Adding Tasks:** `/add`
*   **Message Payload:** A JSON string representing a task object.
    ```json
    {
      "id": "auto-generated-uuid",
      "content": "Task content from MQTT",
      "createdAt": "iso-date-string"
    }
    ```
    The `id` and `createdAt` fields are expected to be generated by the publisher (which, in this project's design, is the `/api/tasks` POST endpoint).

